---
import Layout from '../layouts/Layout.astro';
import { getFunds } from '../lib/data';

export const prerender = true;

const funds = getFunds();
---

<Layout title="まちの数字 - Kiryu Public Log">
  <div class="mx-auto max-w-4xl px-4 py-8">
    <h1 class="text-2xl font-bold text-gray-900">まちの数字</h1>
    <p class="mt-2 text-sm text-gray-500">桐生市の財政に関する公開データ</p>

    {funds ? (
      <>
        <section class="mt-8">
          <h2 class="text-lg font-semibold text-gray-800">基金の状況</h2>
          <p class="mt-1 text-sm text-gray-500">
            {funds.asOf}現在 ―
            <a href={funds.sourceUrl} class="text-blue-600 underline hover:text-blue-800" target="_blank" rel="noopener noreferrer">
              公式サイト原文
            </a>
          </p>

          {/* サマリカード */}
          <div class="mt-4 grid gap-4 sm:grid-cols-3">
            <div class="rounded-lg border border-gray-200 bg-white p-4 text-center">
              <p class="text-sm text-gray-500">基金残高合計</p>
              <p class="mt-1 text-2xl font-bold text-gray-900">
                約{Math.round(funds.grandTotal / 100_000_000)}億円
              </p>
              <p class="mt-1 text-xs text-gray-400">{funds.grandTotal.toLocaleString()}円</p>
            </div>
            <div class="rounded-lg border border-gray-200 bg-white p-4 text-center">
              <p class="text-sm text-gray-500">一般会計</p>
              <p class="mt-1 text-xl font-bold text-gray-900">
                約{Math.round(funds.generalTotal / 100_000_000)}億円
              </p>
              <p class="mt-1 text-xs text-gray-400">{funds.generalTotal.toLocaleString()}円</p>
            </div>
            <div class="rounded-lg border border-gray-200 bg-white p-4 text-center">
              <p class="text-sm text-gray-500">特別会計等</p>
              <p class="mt-1 text-xl font-bold text-gray-900">
                約{Math.round(funds.specialTotal / 100_000_000)}億円
              </p>
              <p class="mt-1 text-xs text-gray-400">{funds.specialTotal.toLocaleString()}円</p>
            </div>
          </div>

          {/* 一般会計テーブル */}
          <div class="mt-8">
            <h3 class="text-base font-semibold text-gray-700">一般会計の基金</h3>
            <div class="mt-3 overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-200 text-left">
                    <th class="py-2 pr-4 font-medium text-gray-600">基金名称</th>
                    <th class="whitespace-nowrap py-2 text-right font-medium text-gray-600">残高</th>
                  </tr>
                </thead>
                <tbody>
                  {funds.funds.filter(f => f.category === '一般会計').map(fund => (
                    <tr class="border-b border-gray-100">
                      <td class="py-2 pr-4 text-gray-900">{fund.name}</td>
                      <td class="whitespace-nowrap py-2 text-right text-gray-700 tabular-nums">
                        {fund.balance.toLocaleString()}円
                      </td>
                    </tr>
                  ))}
                  <tr class="border-t-2 border-gray-300 font-semibold">
                    <td class="py-2 pr-4 text-gray-900">合計</td>
                    <td class="whitespace-nowrap py-2 text-right text-gray-900 tabular-nums">
                      {funds.generalTotal.toLocaleString()}円
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          {/* 特別会計テーブル */}
          <div class="mt-8">
            <h3 class="text-base font-semibold text-gray-700">特別会計及び定額運用の基金</h3>
            <div class="mt-3 overflow-x-auto">
              <table class="w-full text-sm">
                <thead>
                  <tr class="border-b border-gray-200 text-left">
                    <th class="py-2 pr-4 font-medium text-gray-600">基金名称</th>
                    <th class="whitespace-nowrap py-2 text-right font-medium text-gray-600">残高</th>
                  </tr>
                </thead>
                <tbody>
                  {funds.funds.filter(f => f.category === '特別会計等').map(fund => (
                    <tr class="border-b border-gray-100">
                      <td class="py-2 pr-4 text-gray-900">{fund.name}</td>
                      <td class="whitespace-nowrap py-2 text-right text-gray-700 tabular-nums">
                        {fund.balance.toLocaleString()}円
                      </td>
                    </tr>
                  ))}
                  <tr class="border-t-2 border-gray-300 font-semibold">
                    <td class="py-2 pr-4 text-gray-900">合計</td>
                    <td class="whitespace-nowrap py-2 text-right text-gray-900 tabular-nums">
                      {funds.specialTotal.toLocaleString()}円
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </>
    ) : (
      <p class="mt-8 text-gray-500">データが見つかりませんでした。</p>
    )}
  </div>
</Layout>
