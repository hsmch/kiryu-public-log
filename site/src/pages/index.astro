---
import Layout from '../layouts/Layout.astro';
import { getCouncilMembers, getAllSessions, getUpdates } from '../lib/data';

export const prerender = true;

const council = getCouncilMembers();
const sessions = getAllSessions();
const updates = getUpdates();
const totalMembers = council.officers.length + council.members.length;
const totalBills = sessions.reduce((sum, s) => sum + s.data.bills.length, 0);
const recentSessions = sessions.slice(0, 5);
const recentUpdates = updates?.entries.slice(0, 10) ?? [];
---

<Layout>
  <section class="mx-auto max-w-4xl px-4 py-16 sm:py-24">
    <div class="text-center">
      <h1 class="text-4xl font-bold tracking-tight text-gray-900 sm:text-5xl">
        Kiryu Public Log
      </h1>
      <p class="mt-4 text-lg text-gray-600 sm:text-xl">
        桐生市の市政・議会情報を、わかりやすく
      </p>
    </div>

    <!-- 数字サマリ -->
    <div class="mt-12 grid gap-4 sm:grid-cols-3">
      <a href="/council" class="rounded-lg border border-gray-200 bg-white p-6 text-center transition hover:border-blue-300 hover:shadow-sm">
        <p class="text-3xl font-bold text-gray-900">{totalMembers}</p>
        <p class="mt-1 text-sm text-gray-600">議員</p>
      </a>
      <a href="/sessions" class="rounded-lg border border-gray-200 bg-white p-6 text-center transition hover:border-blue-300 hover:shadow-sm">
        <p class="text-3xl font-bold text-gray-900">{sessions.length}</p>
        <p class="mt-1 text-sm text-gray-600">定例会・臨時会</p>
      </a>
      <a href="/sessions" class="rounded-lg border border-gray-200 bg-white p-6 text-center transition hover:border-blue-300 hover:shadow-sm">
        <p class="text-3xl font-bold text-gray-900">{totalBills.toLocaleString()}</p>
        <p class="mt-1 text-sm text-gray-600">議案・請願</p>
      </a>
    </div>

    <!-- 新着更新情報 -->
    {recentUpdates.length > 0 && (
      <div class="mt-12">
        <h2 class="text-lg font-semibold text-gray-800">新着更新情報</h2>
        <div class="mt-4 space-y-2">
          {recentUpdates.map((entry) => (
            <a
              href={entry.url}
              target="_blank"
              rel="noopener noreferrer"
              class="block rounded-lg border border-gray-200 bg-white px-4 py-3 transition hover:border-blue-300 hover:shadow-sm"
            >
              <div class="flex items-start gap-3">
                <span class="shrink-0 text-sm text-gray-400">{entry.date}</span>
                <span class={`shrink-0 rounded px-1.5 py-0.5 text-xs font-medium ${entry.label === '新規' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'}`}>
                  {entry.label}
                </span>
                <span class="text-sm text-gray-900">{entry.title}</span>
              </div>
            </a>
          ))}
        </div>
      </div>
    )}

    <!-- 最近のセッション -->
    <div class="mt-12">
      <h2 class="text-lg font-semibold text-gray-800">最近の定例会・臨時会</h2>
      <div class="mt-4 space-y-3">
        {recentSessions.map((s) => (
          <a
            href={`/sessions/${s.slug}`}
            class="block rounded-lg border border-gray-200 bg-white px-4 py-3 transition hover:border-blue-300 hover:shadow-sm"
          >
            <div class="flex items-center justify-between">
              <p class="font-medium text-gray-900">{s.data.session}</p>
              <span class="text-sm text-gray-500">{s.data.bills.length}件</span>
            </div>
            {s.data.dates.length > 0 && (
              <p class="mt-0.5 text-xs text-gray-400">{s.data.dates[0]}</p>
            )}
          </a>
        ))}
      </div>
      <p class="mt-4 text-center">
        <a href="/sessions" class="text-sm text-blue-600 underline hover:text-blue-800">
          すべての定例会・臨時会を見る
        </a>
      </p>
    </div>

    <p class="mt-12 text-center text-sm text-gray-500">
      公式情報は
      <a
        href="https://www.city.kiryu.lg.jp/shigikai/index.html"
        class="text-blue-600 underline hover:text-blue-800"
        target="_blank"
        rel="noopener noreferrer"
      >
        桐生市議会公式サイト
      </a>
      をご覧ください。
    </p>
  </section>
</Layout>
