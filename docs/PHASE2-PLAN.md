# Kiryu Public Log Phase 2 拡充計画

## 現状の課題

サイトには「データの一覧」はあるが、「読んで分かる」「見て分かる」コンテンツが少ない。
一般市民がアクセスしたときに「で、何が起きてるの？」が伝わらない。

---

## A. 投票行動の可視化

### 目的
議員がどの議案に賛成/反対したかを一覧で見られるようにする。
現状は PDF リンクがあるだけで中身が見えない。

### データソース
- `data/sessions/*.json` 内の `votingRecordPdfUrl`（令和以降の定例会に存在）
- PDF の中身は議案×議員のマトリクス表

### やること
1. **賛否 PDF のパース** — `pipeline/src/scrape-voting-records.ts`
   - PDF をダウンロードしてテーブル構造を抽出
   - 議案ごとに各議員の賛否（○/×/欠席/議長）を構造化
   - `data/voting/` に定例会ごとの JSON として保存
2. **定例会ページに賛否テーブルを追加** — `/sessions/[slug]`
   - 議案ごとの賛否を色分けマトリクスで表示
   - 全会一致 / 賛否割れ が一目でわかるようにする
3. **議員詳細ページに投票履歴を追加** — `/council/[slug]`
   - 議員ごとの議案賛否リスト
   - 賛成率・反対率のサマリ

### 想定データ構造
```typescript
interface VoteRecord {
  billNumber: string;
  billTitle: string;
  result: string;
  votes: { memberName: string; vote: "賛成" | "反対" | "欠席" | "議長" | "退席" }[];
}
interface VotingData {
  session: string;
  sessionSlug: string;
  sourceUrl: string;
  scrapedAt: string;
  records: VoteRecord[];
}
```

### リスク
- PDF のテーブル構造が年度ごとに異なる可能性
- 議長は採決に参加しない（裁決権のみ）ためデータの扱いに注意

### 優先度: 高
既にデータ（PDF）が手元にあり、サイトの差別化に直結する。

---

## B. まちの数字の拡充

### 目的
基金残高だけでなく、市の財政・人口の全体像を伝える。
「桐生市ってどんな規模のまち？」が分かるページにする。

### B-1. 人口データ

#### データソース候補
- 桐生市 統計情報ページ (`/shisei/1018369/index.html`)
- 群馬県 統計情報（市町村別人口）
- e-Stat（国勢調査、住民基本台帳）

#### やること
- 利用可能なデータ形式（HTML / CSV / Excel / PDF）を調査
- 人口推移（過去20年程度）をグラフ表示
- 世帯数・高齢化率なども取れれば追加

### B-2. 予算・決算の概要

#### データソース候補
- 桐生市 予算ページ (`/shisei/zaisei/`)
  - 当初予算の概要 PDF
  - 決算の概要 PDF
- 群馬県「市町村財政状況資料集」（Excel 形式、比較に使える）

#### やること
- まず直近1〜2年分の一般会計歳入歳出の大分類を手動 or PDF 解析で取得
- 歳入（市税・地方交付税・国庫支出金など）の内訳
- 歳出（民生費・教育費・土木費など）の内訳
- 円グラフ or 棒グラフで可視化

### 表示イメージ: `/finance` の拡張
- サマリカード: 一般会計総額、人口、一人あたり予算
- 歳入・歳出の内訳チャート
- 人口推移グラフ
- 基金残高テーブル（既存）

### 優先度: 中
データ入手の調査が必要。PDF 解析の手間は大きいが、年1回更新で済む。

---

## C. 議会カレンダー

### 目的
「次の定例会はいつ？」「今どの段階？」をトップページで伝える。

### データソース
- 議会日程ページ (`/shigikai/honkaigi/nittei/`)
- 新着情報から日程関連エントリを抽出

### やること
1. **日程スクレイパー** — `pipeline/src/scrape-schedule.ts`
   - 年間の本会議・委員会の日程を取得
   - `data/schedule.json` に保存
2. **トップページに直近の予定を表示**
   - 次の定例会の日程
   - 「本会議 → 委員会 → 最終日」のフロー表示
3. **過去の定例会もカレンダー表示**
   - 年度ごとの定例会一覧を時系列で

### 想定データ構造
```typescript
interface ScheduleEntry {
  date: string;          // "2026-03-01"
  type: "本会議" | "委員会" | "全員協議会" | "その他";
  session: string;       // "令和8年第1回定例会"
  description: string;   // "開会日" / "一般質問（1日目）" / "最終日"
}
interface ScheduleData {
  sourceUrl: string;
  scrapedAt: string;
  entries: ScheduleEntry[];
}
```

### 優先度: 中
トップページの「今何が起きてるか」感を大きく改善できる。

---

## D. トピック整理・AI 要約

### 目的
議案や一般質問を「テーマ」で横断的に見られるようにする。
例: 「人口減少」に関する議案・質問を時系列で一覧。

### やること
1. **タグ付け** — Claude API で各議案・質問にテーマタグを付与
   - 入力: 議案タイトル、一般質問の件名と要旨
   - 出力: タグ（例: 子育て、防災、まちづくり、福祉、教育、産業、財政...）
   - `data/tags.json` にマッピングを保存
2. **テーマ別ページ** — `/topics/[tag]`
   - タグごとに関連する議案・質問を時系列表示
   - どの議員がどのテーマに関心を持っているかが分かる
3. **トップページにトピックチップを表示**
   - 最近の定例会で多かったテーマを表示

### 想定データ構造
```typescript
interface TagEntry {
  type: "bill" | "question";
  sessionSlug: string;
  // bill の場合
  billNumber?: string;
  // question の場合
  memberName?: string;
  itemTitle?: string;
  // 共通
  tags: string[];
}
interface TagsData {
  generatedAt: string;
  model: string;        // 使用した Claude モデル
  entries: TagEntry[];
}
```

### CLAUDE.md の設計方針との整合
- AI 要約であることを明示する
- 原文（議案・質問）へのリンクを必ず併記する
- タグ付けのみで、意見や評価は加えない

### コスト見積もり
- 議案数: 約70件/年 × 10年 = 700件
- 質問数: 約80名分/年 × 10年 = 800件
- Haiku で処理すれば数百円程度

### 優先度: 中〜低
Phase 3 に位置づけられていた機能。タグ付けだけなら比較的シンプル。

---

## E. 用語集・ガイドページ

### 目的
議会の仕組みに馴染みのない市民に向けた説明コンテンツ。

### やること
- `/about` ページの充実（サイトの趣旨、中立性、運営者情報）
- `/guide` ページの新設
  - 桐生市議会の基本情報（定数、会派、委員会の役割）
  - 定例会の流れ（議案提出 → 委員会付託 → 質疑 → 採決）
  - 用語集（可決/否決/継続審査/付託/請願/陳情 など）
  - 「議案結果の見方」「賛否表の見方」

### 優先度: 低（ただし /about はサイトの信頼性に直結）
静的コンテンツなので技術的には簡単。内容の正確性が重要。

---

## 実装順序

| 順序 | 機能 | 状態 |
|------|------|------|
| 1 | B. まちの数字の拡充 | 未着手 |
| 2 | E. 用語集・aboutページ | 未着手 |
| 3 | D. トピック整理・AI要約 | 未着手 |
| 4 | A. 投票行動の可視化 | 未着手 |
| 5 | C. 議会カレンダー | 未着手 |

---

## 検証方法（共通）

各機能ごと:
1. スクレイパーを実行し、`data/` に JSON が正しく出力されるか確認
2. `cd site && npm run build` でビルドエラーがないことを確認
3. `npx astro dev` で該当ページの表示を目視確認
4. 2回目のスクレイパー実行で既存データが壊れないことを確認
